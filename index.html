<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Couch Potato Schools</title>
<style>
  :root{
    --bg:#0e0f12; /* Keep a fallback color */
    --panel:#151618; 
    --accent:#7c5cff; 
    --gap:18px;
  }
  
  @keyframes background-pan {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }

  @keyframes rotate {
    to {
      transform: rotate(360deg);
    }
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    min-height:100vh;
    background-image: url('assets/CPSBackgroundImg.png');
    background-size: 150%; 
    background-position: center;
    background-attachment: fixed;
    background-color: var(--bg);
    color:#fff;
    font-family:Inter,system-ui,Arial;
    animation: background-pan 50s linear infinite;
  }
  
  header{padding:72px 18px;text-align:center;font-size:2.6rem;font-weight:800;background:linear-gradient(90deg,#1b1b1b,#262626)}
  .search-toggle{display:block;margin:20px auto;background:var(--accent);border:none;padding:10px 18px;border-radius:10px;color:#fff;cursor:pointer}
  .search-container{display:flex;justify-content:center;overflow:hidden;height:0;transition:height .28s}
  .search-container.active{height:68px}
  .search-container input{width:60%;max-width:520px;margin-top:14px;padding:12px 14px;border-radius:10px;border:0;background:#1d1d1f;color:#fff}
  .card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--gap);padding:32px;max-width:1280px;margin:0 auto}
  
  .card{
    position: relative;
    isolation: isolate;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
    border-radius: 12px;
    overflow: hidden;
    aspect-ratio: 1/1;
    cursor: pointer;
    background: var(--panel);
    transition: transform .18s, box-shadow .18s;
  }

  .card-image-wrapper {
    width: 60%;
    aspect-ratio: 1/1;
    overflow: hidden;
    border-radius: 12px;
  }

  .card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 12px;
  }
  
  .card::after {
    content: '';
    position: absolute;
    inset: -2px;
    z-index: -1;
    border-radius: 12px;
    /* This creates a rotating glow effect rather than a grid pattern */
    background: conic-gradient(
      #ff61e2 0deg,
      #4a82ff 90deg,
      #ffbe7c 180deg,
      #82ffc9 270deg,
      #ff61e2 360deg
    );
    filter: blur(5px);
    animation: rotate 4s linear infinite;
  }
  
  .card:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 12px 30px rgba(0,0,0,.5)}
  .counter{position:absolute;top:8px;right:8px;width:30px;height:30px;border-radius:50%;background:rgba(124,92,255,.85);display:flex;align-items:center;justify-content:center;font-weight:700}
  .footer-note{color:#9aa3b2;text-align:center;padding:18px 12px 36px;font-size:0.95rem}
  
  @media(max-width:600px){ 
    header{font-size:1.8rem} 
    .search-container input{width:84%} 
  }
</style>



</head>
<body>

<header>Couch Potato Schoolz</header>

<button id="toggleBtn" class="search-toggle" aria-expanded="false">Search</button>
<div id="searchContainer" class="search-container" aria-hidden="true">
  <input id="searchInput" type="text" placeholder="Type to search (hidden names) — eg: ocean, forest" aria-label="Search cards">
</div>

<main>
  <div class="card-grid" id="cardGrid">
    <!-- add or duplicate cards as you like. data-view is the key passed to viewer.html -->
    <div class="card" data-name="geometrydashleveleditor" data-view="geometrydashleveleditor" title="geometrydashleveleditor">
      <img src="assets/geometrydashleveleditor.png" alt="">
      <div class="counter">0</div>
    </div>

    <div class="card" data-name="arc" data-view="arc" title="arc">
      <img src="assets/Arc.png" alt="">
      <div class="counter">0</div>
    </div>

    <div class="card" data-name="Galaxy" data-view="galaxy" title="Galaxy">
      <img src="https://picsum.photos/seed/galaxy/800/800" alt="">
      <div class="counter">0</div>
    </div>

    <div class="card" data-name="City" data-view="city" title="City">
      <img src="https://picsum.photos/seed/city/800/800" alt="">
      <div class="counter">0</div>
    </div>

    <!-- add more cards below if needed -->
  </div>
</main>

<div class="footer-note">Click a square to open its viewer in a new about:blank tab (viewer loads inside an iframe).</div>

<script>
/* Gallery behavior:
   - Toggleable typing search
   - Counter per card (localStorage)
   - On card click: open a new about:blank tab and inject a document that contains an iframe to viewer.html?view=...
*/

const toggleBtn = document.getElementById('toggleBtn');
const searchContainer = document.getElementById('searchContainer');
const searchInput = document.getElementById('searchInput');
const cards = Array.from(document.querySelectorAll('.card'));

// Toggle search
toggleBtn.addEventListener('click', () => {
  const active = searchContainer.classList.toggle('active');
  toggleBtn.setAttribute('aria-expanded', String(active));
  searchContainer.setAttribute('aria-hidden', String(!active));
  if (active) setTimeout(() => searchInput.focus(), 200);
  else { searchInput.value = ''; applyFilter(''); }
});

// Typing search (matches hidden data-name)
searchInput.addEventListener('input', () => {
  applyFilter(searchInput.value.trim().toLowerCase());
});
function applyFilter(term) {
  cards.forEach(card => {
    const name = (card.dataset.name || '').toLowerCase();
    card.style.display = name.includes(term) ? '' : 'none';
  });
}

// Initialize counters from localStorage and bind click
cards.forEach(card => {
  const name = card.dataset.name;
  const counterEl = card.querySelector('.counter');
  let count = parseInt(localStorage.getItem('count:' + name)) || 0;
  counterEl.textContent = count;

  card.addEventListener('click', () => {
    // increment counter + save
    count++;
    localStorage.setItem('count:' + name, String(count));
    counterEl.textContent = count;

    // open about:blank in new tab and inject a small shell that loads viewer.html in an iframe
    // NOTE: window.open may be blocked by popup blockers if not triggered by a user gesture.
    const viewKey = encodeURIComponent(card.dataset.view || '');
    const newTab = window.open('about:blank', '_blank');

    if (!newTab) {
      alert('Popup blocked — allow popups for this site to open the viewer.');
      return;
    }

    // Write a minimal HTML shell into the about:blank tab that contains an iframe pointing to viewer.html
    // viewer.html receives ?view=VIEWKEY and loads the proper content.
    const html = `
      <!doctype html>
      <html lang="en">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Viewer — ${escapeHtml(name)}</title>
        <style>
          html,body{height:100%;margin:0;background:#0e0f12;color:#fff;font-family:Inter,Arial,sans-serif;overflow:hidden}
          iframe{position:fixed;inset:0;width:100%;height:100%;border:0;background:#000}
        </style>
      </head>
      <body>
        <iframe src="viewer.html?view=${viewKey}" aria-label="Content viewer"></iframe>
      </body>
      </html>
    `;

    // Write + close (makes the about:blank tab render the shell).
    newTab.document.open();
    newTab.document.write(html);
    newTab.document.close();
  });
});

// small helper to escape title content
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
</script>

</body>
</html>
