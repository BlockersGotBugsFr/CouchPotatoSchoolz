<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Couch Potato Schools</title>
<style>
  :root{
    --bg:#0e0f12;
    --panel:#151618;
    --accent:#7c5cff;
    --gap:18px;
  }

  @keyframes background-pan {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }

  @keyframes border-glow-professional {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    background-image: url('assets/CPSBackgroundImg.png');
    background-size: 150%;
    background-position: center;
    background-attachment: fixed;
    background-color: var(--bg);
    color:#fff;
    font-family:Inter,system-ui,Arial;
    animation: background-pan 50s linear infinite;
    min-height: 100vh;
    overflow-y: auto;
    filter: blur(5px);
    animation: border-glow-professional 8s linear infinite;
  }

  .card::after {
    background: var(--panel);
    inset: 2px;
  }

  .card:hover{
    transform:translateY(-6px) scale(1.02);
    box-shadow:0 12px 30px rgba(0,0,0,.5);
  }

  .counter{
    position:absolute;
    top:8px;
    right:8px;
    width:30px;
    height:30px;
    border-radius:50%;
    background:rgba(124,92,255,.85);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
  }

  .footer-note{
    color:#9aa3b2;
    text-align:center;
    padding:18px 12px 36px;
    font-size:0.95rem;
  }

  /* ✅ SCROLL FIX */
  html, body {
    height: auto !important;
    overflow-y: auto !important;
  }
  main {
    min-height: 100vh;
    overflow: visible;
    display: block;
  }

  @media(max-width:600px){
    header{font-size:1.8rem}
    .search-container input{width:84%}
  }
</style>
</head>
<body>

<header>Couch Potato Schoolz</header>

<button id="toggleBtn" class="search-toggle" aria-expanded="false">Search</button>
<div id="searchContainer" class="search-container" aria-hidden="true">
  <input id="searchInput" type="text" placeholder="Type to search (hidden names) — eg: ocean, forest" aria-label="Search cards">
</div>

<main>
  <div class="card-grid" id="cardGrid">
    <div class="card" data-name="geometrydashleveleditor" data-view="geometrydashleveleditor" title="geometrydashleveleditor">
      <img src="assets/geometrydashleveleditor.png" alt="">
      <div class="counter">0</div>
    </div>

    <div class="card" data-name="arc" data-view="arc" title="arc">
      <img src="assets/Arc.png" alt="">
      <div class="counter">0</div>
    </div>

    <div class="card" data-name="Galaxy" data-view="galaxy" title="Galaxy">
      <img src="https://picsum.photos/seed/galaxy/800/800" alt="">
      <div class="counter">0</div>
    </div>

    <div class="card" data-name="City" data-view="city" title="City">
      <img src="https://picsum.photos/seed/city/800/800" alt="">
      <div class="counter">0</div>
    </div>
  </div>
</main>

<div class="footer-note">
  Click a square to open its viewer in a new about:blank tab (viewer loads inside an iframe).
</div>

<script>
const toggleBtn = document.getElementById('toggleBtn');
const searchContainer = document.getElementById('searchContainer');
const searchInput = document.getElementById('searchInput');
const cards = Array.from(document.querySelectorAll('.card'));

toggleBtn.addEventListener('click', () => {
  const active = searchContainer.classList.toggle('active');
  toggleBtn.setAttribute('aria-expanded', String(active));
  searchContainer.setAttribute('aria-hidden', String(!active));
  if (active) setTimeout(() => searchInput.focus(), 200);
  else { searchInput.value = ''; applyFilter(''); }
});

searchInput.addEventListener('input', () => {
  applyFilter(searchInput.value.trim().toLowerCase());
});
function applyFilter(term) {
  cards.forEach(card => {
    const name = (card.dataset.name || '').toLowerCase();
    card.style.display = name.includes(term) ? '' : 'none';
  });
}

cards.forEach(card => {
  const name = card.dataset.name;
  const counterEl = card.querySelector('.counter');
  let count = parseInt(localStorage.getItem('count:' + name)) || 0;
  counterEl.textContent = count;

  card.addEventListener('click', () => {
    count++;
    localStorage.setItem('count:' + name, String(count));
    counterEl.textContent = count;

    const viewKey = encodeURIComponent(card.dataset.view || '');
    const newTab = window.open('about:blank', '_blank');

    if (!newTab) {
      alert('Popup blocked — allow popups for this site to open the viewer.');
      return;
    }

    const html = `
      <!doctype html>
      <html lang="en">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Viewer — ${escapeHtml(name)}</title>
        <style>
          html,body{height:100%;margin:0;background:#0e0f12;color:#fff;font-family:Inter,Arial,sans-serif;overflow:hidden}
          iframe{position:fixed;inset:0;width:100%;height:100%;border:0;background:#000}
        </style>
      </head>
      <body>
        <iframe src="viewer.html?view=${viewKey}" aria-label="Content viewer"></iframe>
      </body>
      </html>
    `;
    newTab.document.open();
    newTab.document.write(html);
    newTab.document.close();
  });
});

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, c => (
    {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]
  ));
}
</script>
</body>
</html>
